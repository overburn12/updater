
{% extends "base.html" %}

{% block title %}
   {{ servername }} SQL query
{% endblock %}

{% block head %}
{% endblock %}

{% block content %}

{{ block_header(servername)}}
    <textarea id="queryInput" style="width: 100%; height: 30em;"></textarea>
    <button onclick="submitQuery()">Run Query</button>
    <button onclick="clearOutput()">Clear Output</button>
{{ block_footer() }}

{{block_header('Query Results')}}
    <div id="query_results"></div>
{{block_footer()}}

<script>
    function submitQuery() {
        document.getElementById('query_results').innerHTML = '';
        const query = document.getElementById('queryInput').value;
        var server_name = '{{ servername }}';
        fetch('https://overburn.org/updater/sql/' + server_name, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ query: query })
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('query_results').innerHTML = createHtmlTableFromData(data);
            console.log('Data received:', data);
        }).catch(error => {
            console.log('catch-error: ', error);
        });
    }

    function createHtmlTableFromData(data) {
        let tableHtml = "<table><thead><tr>";
        data.columns.forEach(column => {
            tableHtml += `<th>${column}</th>`;
        });
        tableHtml += "</tr></thead><tbody>";
        data.rows.forEach(row => {
            tableHtml += "<tr>";
            data.columns.forEach(column => {
                tableHtml += `<td>${row[column]}</td>`;
            });
            tableHtml += "</tr>";
        });
        tableHtml += "</tbody></table>";
        return tableHtml;
    }
</script>

{% endblock %}
